name: UnitTest

on: [push, pull_request]


jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4


    - name: Install Dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential cmake ninja-build wget tar

    - name: Install Googletest 1.16.0
      run: |
        wget https://github.com/google/googletest/archive/refs/tags/release-1.16.0.tar.gz
        tar -xzf release-1.16.0.tar.gz
        cd googletest-release-1.16.0
        mkdir build
        cd build
        cmake .. -DCMAKE_INSTALL_PREFIX=/usr/local
        make -j$(nproc)
        sudo make install

    - name: Install Benchmark 1.9.1
      run: |
        wget https://github.com/google/benchmark/archive/refs/tags/v1.9.1.tar.gz
        tar -xzf v1.9.1.tar.gz
        cd benchmark-v1.9.1
        mkdir build
        cd build
        cmake .. -DCMAKE_INSTALL_PREFIX=/usr/local
        make -j$(nproc)
        sudo make install

    - name: Test
      run: |
        cd optimus
        make ts_sum_test

